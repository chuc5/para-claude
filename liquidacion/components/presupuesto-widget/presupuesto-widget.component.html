<!-- ========================================================================== -->
<!-- WIDGET - PRESUPUESTO DISPONIBLE                                          -->
<!-- Diseño optimizado y minimalista                                          -->
<!-- ========================================================================== -->

<!-- Cargando -->
<div *ngIf="cargando()" class="bg-white rounded-lg border border-gray-200 p-4">
    <div class="flex items-center justify-center">
        <div class="animate-spin rounded-full h-6 w-6 border-2 border-blue-600 border-t-transparent"></div>
    </div>
</div>

<!-- Sin datos -->
<div *ngIf="!cargando() && !presupuesto()" class="bg-white rounded-lg border border-gray-200 p-4">
    <div class="text-center text-xs text-gray-500">
        No hay presupuesto configurado
    </div>
</div>

<!-- Widget de Presupuesto -->
<div *ngIf="!cargando() && presupuesto()" class="bg-white rounded-lg border border-gray-200 shadow-sm">

    <!-- Header -->
    <div class="flex items-center gap-2 p-3 border-b border-gray-100">
        <div class="w-8 h-8 bg-blue-50 rounded-lg flex items-center justify-center flex-shrink-0">
            <lucide-icon [img]="Wallet" class="w-4 h-4 text-blue-600"></lucide-icon>
        </div>
        <div class="min-w-0 flex-1">
            <h3 class="text-sm font-semibold text-gray-900 truncate">Presupuesto Disponible</h3>
            <p class="text-xs text-gray-500 truncate">{{ presupuesto()!.agencia }} • {{ presupuesto()!.puesto }}</p>
        </div>
    </div>

    <!-- Body -->
    <div class="p-3 space-y-3">

        <!-- PRESUPUESTO ANUAL -->
        <div>
            <!-- Label -->
            <div class="flex items-center justify-between mb-1.5">
                <p class="text-xs font-medium text-gray-500 uppercase tracking-wide">Anual {{ presupuesto()!.anio }}</p>
                <span class="text-xs font-semibold"
                    [ngClass]="getClaseTextoProgreso(presupuesto()!.presupuesto_anual.porcentaje_usado)">
                    {{ formatPorcentaje(presupuesto()!.presupuesto_anual.porcentaje_usado) }}
                </span>
            </div>

            <!-- Monto -->
            <div class="mb-1.5">
                <div class="flex items-baseline gap-1.5">
                    <span class="text-lg font-bold text-gray-900">
                        {{ formatMoneda(presupuesto()!.presupuesto_anual.disponible) }}
                    </span>
                    <span class="text-xs text-gray-500">
                        / {{ formatMoneda(presupuesto()!.presupuesto_anual.total) }}
                    </span>
                </div>
            </div>

            <!-- Barra de progreso -->
            <div class="h-1.5 bg-gray-100 rounded-full overflow-hidden">
                <div class="h-full rounded-full transition-all duration-300"
                    [ngClass]="getClaseBarraProgreso(presupuesto()!.presupuesto_anual.porcentaje_usado)"
                    [style.width.%]="presupuesto()!.presupuesto_anual.porcentaje_usado"></div>
            </div>

            <!-- Alerta crítico -->
            <div *ngIf="presupuestoAnualCritico()"
                class="mt-1.5 flex items-start gap-1.5 p-2 bg-red-50 border border-red-200 rounded text-xs text-red-700">
                <lucide-icon [img]="TrendingDown" class="w-3 h-3 mt-0.5 flex-shrink-0"></lucide-icon>
                <span>Nivel crítico</span>
            </div>

            <!-- Advertencia -->
            <div *ngIf="presupuestoAnualAdvertencia()"
                class="mt-1.5 flex items-start gap-1.5 p-2 bg-yellow-50 border border-yellow-200 rounded text-xs text-yellow-700">
                <lucide-icon [img]="TrendingUp" class="w-3 h-3 mt-0.5 flex-shrink-0"></lucide-icon>
                <span>Acercándose al límite</span>
            </div>
        </div>

        <!-- Divisor -->
        <div class="border-t border-gray-100"></div>

        <!-- PRESUPUESTO MENSUAL -->
        <div>
            <!-- Label -->
            <div class="flex items-center justify-between mb-1.5">
                <p class="text-xs font-medium text-gray-500 uppercase tracking-wide">Mensual</p>
                <span class="text-xs font-semibold"
                    [ngClass]="getClaseTextoProgreso(presupuesto()!.presupuesto_mensual.porcentaje_usado)">
                    {{ formatPorcentaje(presupuesto()!.presupuesto_mensual.porcentaje_usado) }}
                </span>
            </div>

            <!-- Monto -->
            <div class="mb-1.5">
                <div class="flex items-baseline gap-1.5">
                    <span class="text-lg font-bold text-gray-900">
                        {{ formatMoneda(presupuesto()!.presupuesto_mensual.disponible) }}
                    </span>
                    <span class="text-xs text-gray-500">
                        / {{ formatMoneda(presupuesto()!.presupuesto_mensual.calculado) }}
                    </span>
                </div>
            </div>

            <!-- Barra de progreso -->
            <div class="h-1.5 bg-gray-100 rounded-full overflow-hidden">
                <div class="h-full rounded-full transition-all duration-300"
                    [ngClass]="getClaseBarraProgreso(presupuesto()!.presupuesto_mensual.porcentaje_usado)"
                    [style.width.%]="presupuesto()!.presupuesto_mensual.porcentaje_usado"></div>
            </div>

            <!-- Info de días -->
            <div class="mt-1.5 flex items-center gap-1.5 text-xs text-gray-500">
                <lucide-icon [img]="Calendar" class="w-3 h-3 flex-shrink-0"></lucide-icon>
                <span class="truncate">Día {{ presupuesto()!.presupuesto_mensual.dias_transcurridos }} del mes</span>
            </div>

            <!-- Alerta crítico -->
            <div *ngIf="presupuestoMensualCritico()"
                class="mt-1.5 flex items-start gap-1.5 p-2 bg-red-50 border border-red-200 rounded text-xs text-red-700">
                <lucide-icon [img]="TrendingDown" class="w-3 h-3 mt-0.5 flex-shrink-0"></lucide-icon>
                <span>Nivel crítico</span>
            </div>

            <!-- Advertencia -->
            <div *ngIf="presupuestoMensualAdvertencia()"
                class="mt-1.5 flex items-start gap-1.5 p-2 bg-yellow-50 border border-yellow-200 rounded text-xs text-yellow-700">
                <lucide-icon [img]="TrendingUp" class="w-3 h-3 mt-0.5 flex-shrink-0"></lucide-icon>
                <span>Acercándose al límite</span>
            </div>
        </div>

    </div>

    <!-- Footer info -->
    <div class="px-3 py-2 bg-gray-50 border-t border-gray-100 rounded-b-lg">
        <p class="text-xs text-gray-500">
            Diario: <span class="font-medium text-gray-700">{{ formatMoneda(presupuesto()!.monto_diario) }}</span>
        </p>
    </div>
</div>